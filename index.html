<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dish Picker with Top Pakistani Recipes</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00bcd4">
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: sans-serif;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100vh; margin: 0; text-align: center;
    }
    .spinner {
      display: none; margin: 20px;
      width: 50px; height: 50px;
      border: 6px solid #444; border-top: 6px solid #00bcd4;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    button {
      background: #00bcd4; color: #fff;
      padding: 10px 20px; font-size: 18px;
      border: none; border-radius: 8px; cursor: pointer;
    }
    .result { margin-top: 20px; font-size: 18px; text-align: left; max-width: 90%; }
    .link { color: #4FC3F7; text-decoration: none; font-weight: bold; }
    .date { margin-top: 30px; font-size: 14px; color: #ccc; }
    ul { list-style: none; padding: 0; }
    li { margin-bottom: 20px; }
    li strong { font-size: 20px; }
    li .meta { font-size: 14px; color: #999; }
    .signature {
      position: absolute;
      bottom: 10px;
      left: 10px;
      font-size: 12px;
      color: #fff;
    }
    .install-btn {
      position: absolute;
      bottom: 50px;
      right: 10px;
      background: #ff4081;
    }
    .dish-select {
      margin-top: 10px;
    }
    .dish-select button {
      background-color: #4CAF50;
      font-size: 14px;
      margin-top: 5px;
    }
    .note {
      font-size: 13px;
      color: #aaa;
      margin-top: 10px;
      max-width: 80%;
    }
    .toast-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #00bcd4;
      color: white;
      font-size: 16px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 9999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .toast-bar button {
      background: white;
      color: #00bcd4;
      font-weight: bold;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="toastBar" class="toast-bar" style="display: none;">
    üì≤ Install this app for quick access!
    <button id="toastInstallBtn">Install</button>
  </div>

  <h1>üçΩÔ∏è Aaj kya pakayen?</h1>
  <div class="spinner" id="spinner"></div>
  <button id="startBtn">Start</button>
  <div class="result" id="result">Press ‚ÄúStart‚Äù to get 3 dish ideas and recipe links.</div>
  <div class="note" id="note" style="display:none;">
    Select the dish you're going to cook today, so we avoid showing it again this month and keep your meals exciting!
  </div>
  <div class="date" id="date"></div>
  <div class="signature">Created by Syed Hassan Ali</div>
  <button id="installBtn" class="install-btn" style="display: none;">Install App</button>

  <script>
    const dishes = `Achari Chicken, Achari Gosht, Aloo Baingan, Aloo Biryani, Aloo Cutlets, Aloo Ghost, Aloo Gosht, Aloo Kabab, Aloo Ki Bhujiya, Aloo Matar Ka Salan, Aloo Methi, Aloo Palak, Aloo Paratha, Aloo Qeema, Anda Aloo Curry, Anda Bhurji, Anda Chana, Anda Curry, Anda Ka Salan, Anda Qeema, Anday Ka Salan, Anday Tori, Arhar Ki Daal, Arvi Gosht, Arvi Ki Bhujiya, Baingan Ka Bharta, Baisan Ke Parathy, Beef Korma, Beef Nihari, Beef Stew, Besan Ki Roti, Bhindi Gosht, Bhooni Hoe Moong Ki Daal, Bhuna Gosht, Biryani, Chana Daal, Chana Masala, Chane Ki Daal Ki Qubooli, Chapli Kabab, Chicken Achari Handi, Chicken Biryani, Chicken Curry, Chicken Haleem, Chicken Handi, Chicken Jalfrezi, Chicken Karahi, Chicken Kofta, Chicken Pulao, Chicken Qeema, Chicken Qorma, Chicken Shorba, Chicken Stew, Chicken Tehri, Chicken White Handi, Cholay Biryani, Cholay Ka Salan, Custard, Daal Chawal, Daal Fry, Daal Mash, Daal Moong, Dum Ka Qeema, Dahi Baray Roti, Fish Curry, Gajar Matar, Garlic Bread With Fried Chicken, Haleem, Hinduiani Aloo, Kaddu Gosht, Kaleji Masala, Karhi Chawal, Katakat, Khichri, Kheer, Kofta Curry, Koftay Aloo, Kulfa Karhi, Loki Channe Ki Daal, Loki Gosht, Loki Ki Bhojiya, Makhni Handi, Malaka Masoor Daal, Mangoria, Mangooriyo Ka Salan, Masoor Daal, Mash Daal, Matar Paneer, Matar Pulao, Matar Qeema, Mix Sabzi, Moong Daal, Murg Cholay, Mutton Biryani, Mutton Curry, Mutton Do Pyaza, Mutton Haleem, Mutton Karahi, Mutton Pulao, MUTTON Salan, Nihari, Nargisi Kofta, Paltay, Paneer Qorma, Paya, Qeema Karelay, Rajma, Roghni Naan, Saag, Saag Paneer, Sada Biryani, Shahi Qeema, Shaljam Gosht, Shami Kabab, Shami Kabab Curry, Sheermal, Sashilik, Stoo, Taheri, Taftaan, Timator Wali Masoor Ki Daal, Tikka Biryani, Tinday Gosht, Turnip Curry, Tandoori Roti, Tawa Chicken, Tawa Keema, White Chicken Karahi, White Qorma, Yakhni Pulao, Zarda`.split(/,\s*/);

    const monthKey = new Date().toISOString().slice(0,7);
    const blocked = JSON.parse(localStorage.getItem(`selectedDishes-${monthKey}`) || '[]');

    function saveSelectedDish(dish) {
      if (!blocked.includes(dish)) {
        blocked.push(dish);
        localStorage.setItem(`selectedDishes-${monthKey}`, JSON.stringify(blocked));
        alert(`Enjoy your dish: ${dish} üçΩÔ∏è\nWe won‚Äôt show it again this month to keep your meals exciting!`);
      }
    }

    async function fetchTopVideo(dish) {
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&order=viewCount&q=${encodeURIComponent(dish + ' recipe Pakistani')}&maxResults=1&key=AIzaSyCa740ajzKVz-vmQTNKB3o_rnCN40Gz9dw`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const vid = data.items?.[0];
        if (vid) {
          return {
            dish,
            title: vid.snippet.title,
            channel: vid.snippet.channelTitle,
            url: `https://www.youtube.com/watch?v=${vid.id.videoId}`
          };
        }
      } catch {}
      return {
        dish,
        title: 'Search on YouTube',
        channel: '',
        url: `https://www.youtube.com/results?search_query=${encodeURIComponent(dish + ' recipe Pakistani')}`
      };
    }

    document.getElementById('startBtn').onclick = async () => {
      const spinner = document.getElementById('spinner');
      const result  = document.getElementById('result');
      const note    = document.getElementById('note');
      spinner.style.display = 'block';
      result.innerHTML = '';
      note.style.display = 'none';

      await new Promise(r => setTimeout(r, 1500));
      spinner.style.display = 'none';

      const filtered = dishes.filter(d => !blocked.includes(d));
      const pick = filtered.sort(() => 0.5 - Math.random()).slice(0, 3);
      const vids = await Promise.all(pick.map(fetchTopVideo));

      result.innerHTML = `<ul>${vids.map(v => `
        <li>
          <strong>${v.dish}</strong><br>
          <a class="link" href="${v.url}" target="_blank">‚ñ∂ ${v.title}</a><br>
          <span class="meta">${v.channel}</span><br>
          <div class="dish-select"><button onclick="saveSelectedDish('${v.dish}')">I‚Äôm cooking this</button></div>
        </li>
      `).join('')}</ul>`;
      note.style.display = 'block';
    };

    document.getElementById('date').textContent = new Date().toLocaleDateString('en-GB', {
      weekday: 'long', day: '2-digit', month: 'short', year: 'numeric'
    });

    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    const toastBar = document.getElementById('toastBar');
    const toastInstallBtn = document.getElementById('toastInstallBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (!localStorage.getItem('appInstalled')) {
        installBtn.style.display = 'block';
        toastBar.style.display = 'flex';
      }
    });

    toastInstallBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          localStorage.setItem('appInstalled', 'true');
          installBtn.style.display = 'none';
          toastBar.style.display = 'none';
        }
        deferredPrompt = null;
      }
    });

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          localStorage.setItem('appInstalled', 'true');
          installBtn.style.display = 'none';
          toastBar.style.display = 'none';
        }
        deferredPrompt = null;
      }
    });

    window.addEventListener('appinstalled', () => {
      localStorage.setItem('appInstalled', 'true');
      installBtn.style.display = 'none';
      toastBar.style.display = 'none';
    });
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(() => console.log('‚úÖ Service Worker Registered'))
        .catch(error => console.log('‚ùå SW Registration Failed:', error));
    }
  </script>

</body>
</html>
